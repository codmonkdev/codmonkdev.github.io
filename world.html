<!DOCTYPE html>
<meta charset="utf-8">
<style>

html,
body,
div {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
}

path {
  fill: #ccc;
  stroke: #fff;
  stroke-width: .5px;
}

path.active {
  fill: green;
}

 
circle {
  /* fill: #fff;
  fill-opacity: 0.9;
  fill: auto;*/
  stroke: #111;
}


circle.active {
  stroke: #0A98F5;
  stroke-width: 5px;
}


</style>
<body>
<script src="js/jquery/jquery-1.12.4.min.js"></script>
<script src="js/d3/4.13.0/d3.min.js"></script>
<script src="js/d3-geo-projection/2.4.1/d3-geo-projection.min.js"></script>
<div id="mapContainer"></div>
<script>

//
var width = '100%',
    height = '100%';

var projection = d3.geoEquirectangular();//geoMercator();
  
var path = d3.geoPath()
  .projection(projection)

var svg = d3.select("div").append("svg")
    .attr("width", width)
    .attr("height", height);

var url = "data/countries.json";//"http://enjalot.github.io/wwsd/data/world/world-110m.geojson";
var url2 = "data/word-country-centroids.json";//"http://enjalot.github.io/wwsd/data/world/ne_50m_populated_places_simple.geojson"
d3.json(url, function(error, countries) {
d3.json(url2, function(error, places) {
  if (error) console.log(error);
  
  console.log("geojson", countries, places);
 
  svg.selectAll("path")
    .data(countries.features)
  .enter().append("path")
    .attr("d", path)
    .on("mouseover",function(d) {
    	console.log("just had a mouseover", d3.select(d));
    	d3.select(this)
      	.classed("active",true)
  	})
  	.on("mouseout",function(d){
    	d3.select(this)
      	.classed("active",false)
    })
  
  var defs = svg.append("defs");
  var imgPattern = defs.selectAll("pattern").data([1,2,3])
    	.enter()
    .append("pattern")
        .attr("id", function(d){if(d==1) return "img1";
								if(d==2) return "img2";
								if(d==3) return "img3";
								})
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("patternUnits", "objectBoundingBox")
		.attr("patternContentUnits", "objectBoundingBox")
    	.append("image")
   		//.attr("x", 0)
    	//.attr("y", 0)
    	.attr("width", 1)
        .attr("height", 1)
		.attr("preserveAspectRatio", "none")
        .attr("xlink:href", function(d){if(d==1) return "http://lar/SmartMap/img/flags/RU.svg";
										if(d==2) return "http://lar/SmartMap/img/flags/US.svg";
										if(d==3) return "http://lar/SmartMap/img/flags/AU.svg";
										})
		//.attr("xmlns:link", function(d){return "http://lar/SmartMap/img/flags/RU.png";})
		;
  
  svg.selectAll("circle")
  	.data(places.features)
  .enter().append("circle")
  	.attr('r',function(d) { 
				console.log("d="+d);
				console.log("d.properties="+d.properties);
				console.log("d.properties.population="+d.properties.population);
				return d.properties.population;}
			)
    .attr('cx',function(d) { return projection(d.geometry.coordinates)[0]})
    .attr('cy',function(d) { return projection(d.geometry.coordinates)[1]})
	
	//.append("img")
	//.attr("src", "http://lar/SmartMap/img/flags/RU.png")
	//.attr("width", "100%")
	//.attr("height", "100%")
	//.style("width", "100%")
	//.style("height", "100%")
	//.style("object-fit", "cover")

	//.style("background", "http://lar/SmartMap/img/flags/RU.png")
	//.style("background-size", "cover")
	
	//.style("fill", "#fff")
	//.style("object-fit", "fill")
	.style("fill", function(d){if(d.id=="RUS") return "url(#img1)";
								if(d.id=="USA") return "url(#img2)";
								if(d.id=="AUS") return "url(#img3)";
								})
								
	.on("mouseover",function(d) {
    	console.log("just had a mouseover", d3.select(d));
    	d3.select(this)
      	.classed("active",true)
  	})
  	.on("mouseout",function(d){
    	d3.select(this)
      	.classed("active",false)
    });

  
  /*svg.selectAll("circle")
  	.data(places.features)
  .enter().append("circle")
  	.attr('r',5)
    .attr('cx',function(d) { return projection(d.geometry.coordinates)[0]})
    .attr('cy',function(d) { return projection(d.geometry.coordinates)[1]})
    .on("mouseover",function(d) {
    	console.log("just had a mouseover", d3.select(d));
    	d3.select(this)
      	.classed("active",true)
  	})
  	.on("mouseout",function(d){
    	d3.select(this)
      	.classed("active",false)
    })*/
  
  })
  
});

</script>